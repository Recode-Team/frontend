{"ast":null,"code":"const assign = require('../util/assign');\nconst LocalCart = {\n  storage: typeof window === 'object' ? window.localStorage : null,\n  storageKey: '__cartItems__',\n  items: null\n};\n\n// ISO Date String -> Date\nLocalCart.parseISOString = s => {\n  const b = s.split(/\\D+/);\n  return new Date(Date.UTC(b[0], --b[1], b[2], b[3], b[4], b[5], b[6]));\n};\n\n// Config LocalCart\nLocalCart.config = options => assign(LocalCart, options);\n\n// Limit total number of items to 50\nLocalCart.limitTotal = items => {\n  if (!items) return;\n  const total = LocalCart.items.reduce((all, item) => {\n    return all.concat(item, item.bundleItems || []);\n  }, []).length;\n  if (total > 50) {\n    LocalCart.items = LocalCart.items.slice(1);\n  }\n};\n\n// Read items from the storage\nLocalCart.loadItems = () => {\n  LocalCart.items = (LocalCart.items || JSON.parse(LocalCart.storage.getItem(LocalCart.storageKey) || '[]')).map(item => {\n    item.addedAt = typeof item.addedAt === 'string' ? LocalCart.parseISOString(item.addedAt) : item.addedAt;\n    return item;\n  });\n  return LocalCart.items;\n};\n\n// Save items to the storage\nLocalCart.saveItems = () => {\n  LocalCart.limitTotal();\n  LocalCart.storage.setItem(LocalCart.storageKey, JSON.stringify(LocalCart.items));\n};\n\n// Set unique item IDs\nLocalCart.setItemDefaults = item => {\n  [].concat(item, item.bundleItems || []).forEach(item => {\n    item._id = item._id || (Math.random() + '').slice(2, 17);\n    item.shippingMethod = item.shippingMethod || null;\n  });\n  return item;\n};\n\n// Find an item by ID\nLocalCart.findItem = (items, itemId) => {\n  if (typeof items === 'string' && !itemId) {\n    itemId = items;\n    items = LocalCart.items;\n  }\n  items = items || [];\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i];\n    if (item._id === itemId + '') {\n      return item;\n    }\n  }\n  return null;\n};\n\n// Add an item\nLocalCart.addItem = LocalCart.addItemForMe = item => {\n  if (!item) return;\n  LocalCart.setItemDefaults(item);\n  item.bundleItems = item.bundleItems || [];\n  item.addedAt = new Date();\n  LocalCart.items = LocalCart.loadItems().concat(item);\n  LocalCart.saveItems();\n  return item;\n};\n\n// Update an item\nLocalCart.updateItem = LocalCart.updateItemForMe = (itemId, update) => {\n  if (!update) return;\n  LocalCart.loadItems();\n  const found = LocalCart.findItem(LocalCart.items, itemId);\n  if (!found) return;\n  const bundleItems = update.bundleItems;\n  delete update.bundleItems;\n  assign(found, update);\n  if (bundleItems) {\n    found.bundleItems = found.bundleItems || [];\n    if (bundleItems.length) {\n      found.bundleItems = bundleItems;\n    } else {\n      for (const bundleId in bundleItems) {\n        const bundleItem = LocalCart.findItem(found.bundleItems, bundleId);\n        const bundleUpdate = bundleItems[bundleId];\n        if (!bundleItem && bundleUpdate) {\n          found.bundleItems.push(bundleUpdate);\n        }\n        if (bundleItem && bundleUpdate) {\n          assign(bundleItem, bundleUpdate);\n        }\n        if (bundleUpdate === null) {\n          found.bundleItems = found.bundleItems.filter(bundleItem => {\n            return bundleItem._id !== bundleId;\n          });\n        }\n      }\n    }\n  }\n  LocalCart.setItemDefaults(found);\n  LocalCart.saveItems();\n  return found;\n};\n\n// Delete an item\nLocalCart.deleteItem = LocalCart.deleteItemForMe = itemId => {\n  LocalCart.items = LocalCart.loadItems().filter(item => {\n    return item._id !== itemId + '';\n  });\n  LocalCart.saveItems();\n};\n\n// Delete all items\nLocalCart.empty = LocalCart.emptyForMe = () => {\n  LocalCart.items = [];\n  LocalCart.saveItems();\n};\n\n// Load all items from the storage when initialized\nLocalCart.loadItems();\nif (typeof module === 'object') {\n  module.exports = LocalCart;\n}\nif (typeof window === 'object') {\n  if (typeof window.Clayful === 'object') {\n    window.Clayful.LocalCart = LocalCart;\n  } else {\n    window.Clayful = {\n      LocalCart\n    };\n  }\n}","map":{"version":3,"names":["assign","require","LocalCart","storage","window","localStorage","storageKey","items","parseISOString","s","b","split","Date","UTC","config","options","limitTotal","total","reduce","all","item","concat","bundleItems","length","slice","loadItems","JSON","parse","getItem","map","addedAt","saveItems","setItem","stringify","setItemDefaults","forEach","_id","Math","random","shippingMethod","findItem","itemId","i","addItem","addItemForMe","updateItem","updateItemForMe","update","found","bundleId","bundleItem","bundleUpdate","push","filter","deleteItem","deleteItemForMe","empty","emptyForMe","module","exports","Clayful"],"sources":["D:/project/Recode-Team/Frontend/node_modules/clayful/lib/local-cart/index.js"],"sourcesContent":["const assign = require('../util/assign');\r\n\r\nconst LocalCart = {\r\n    storage: (typeof window === 'object' ? window.localStorage : null),\r\n    storageKey: '__cartItems__',\r\n    items: null,\r\n};\r\n\r\n// ISO Date String -> Date\r\nLocalCart.parseISOString = (s) => {\r\n\r\n    const b = s.split(/\\D+/);\r\n\r\n    return new Date(Date.UTC(b[0], --b[1], b[2], b[3], b[4], b[5], b[6]));\r\n};\r\n\r\n// Config LocalCart\r\nLocalCart.config = (options) => assign(LocalCart, options);\r\n\r\n// Limit total number of items to 50\r\nLocalCart.limitTotal = (items) => {\r\n\r\n    if (!items) return;\r\n\r\n    const total = LocalCart.items.reduce((all, item) => {\r\n        return all.concat(item, item.bundleItems || []);\r\n    }, []).length;\r\n\r\n    if (total > 50) {\r\n        LocalCart.items = LocalCart.items.slice(1);\r\n    }\r\n\r\n};\r\n\r\n// Read items from the storage\r\nLocalCart.loadItems = () => {\r\n\r\n    LocalCart.items = (\r\n        LocalCart.items ||\r\n        JSON.parse(LocalCart.storage.getItem(LocalCart.storageKey) || '[]')\r\n    ).map((item) => {\r\n        \r\n        item.addedAt = (\r\n            typeof item.addedAt === 'string' ?\r\n                LocalCart.parseISOString(item.addedAt) :\r\n                item.addedAt\r\n        );\r\n\r\n        return item;\r\n    });\r\n\r\n    return LocalCart.items;\r\n\r\n};\r\n\r\n// Save items to the storage\r\nLocalCart.saveItems = () => {\r\n    LocalCart.limitTotal();\r\n    LocalCart.storage.setItem(LocalCart.storageKey, JSON.stringify(LocalCart.items));\r\n};\r\n\r\n// Set unique item IDs\r\nLocalCart.setItemDefaults = (item) => {\r\n\r\n    [].concat(item, item.bundleItems || []).forEach((item) => {\r\n        item._id = item._id || (Math.random() + '').slice(2, 17);\r\n        item.shippingMethod = item.shippingMethod || null;\r\n    });\r\n\r\n    return item;\r\n\r\n};\r\n\r\n// Find an item by ID\r\nLocalCart.findItem = (items, itemId) => {\r\n\r\n    if (typeof items === 'string' && !itemId) {\r\n        itemId = items;\r\n        items = LocalCart.items;\r\n    }\r\n\r\n    items = items || [];\r\n\r\n    for (let i = 0; i < items.length; i++) {\r\n        \r\n        const item = items[i];\r\n\r\n        if (item._id === (itemId + ''))  {\r\n            return item;\r\n        }\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n// Add an item\r\nLocalCart.addItem = LocalCart.addItemForMe = (item) => {\r\n\r\n    if (!item) return;\r\n\r\n    LocalCart.setItemDefaults(item);\r\n    \r\n    item.bundleItems = item.bundleItems || [];\r\n    item.addedAt = new Date();\r\n\r\n    LocalCart.items = LocalCart.loadItems().concat(item);\r\n    LocalCart.saveItems();\r\n\r\n    return item;\r\n\r\n};\r\n\r\n// Update an item\r\nLocalCart.updateItem = LocalCart.updateItemForMe = (itemId, update) => {\r\n\r\n    if (!update) return;\r\n\r\n    LocalCart.loadItems();\r\n    \r\n    const found = LocalCart.findItem(LocalCart.items, itemId);\r\n\r\n    if (!found) return;\r\n\r\n    const bundleItems = update.bundleItems;\r\n\r\n    delete update.bundleItems;\r\n\r\n    assign(found, update);\r\n\r\n    if (bundleItems) {\r\n\r\n        found.bundleItems = found.bundleItems || [];\r\n\r\n        if (bundleItems.length) {\r\n\r\n            found.bundleItems = bundleItems;\r\n            \r\n        } else {\r\n\r\n            for (const bundleId in bundleItems) {\r\n\r\n                const bundleItem = LocalCart.findItem(found.bundleItems, bundleId);\r\n                const bundleUpdate = bundleItems[bundleId];\r\n\r\n                if (!bundleItem && bundleUpdate) {\r\n                    found.bundleItems.push(bundleUpdate);\r\n                }\r\n\r\n                if (bundleItem && bundleUpdate) {\r\n                    assign(bundleItem, bundleUpdate);\r\n                }\r\n\r\n                if (bundleUpdate === null) {\r\n                    found.bundleItems = found.bundleItems.filter((bundleItem) => {\r\n                        return bundleItem._id !== bundleId;\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    LocalCart.setItemDefaults(found);\r\n    LocalCart.saveItems();\r\n\r\n    return found;\r\n\r\n};\r\n\r\n// Delete an item\r\nLocalCart.deleteItem = LocalCart.deleteItemForMe = (itemId) => {\r\n\r\n    LocalCart.items = LocalCart.loadItems().filter((item) => {\r\n        return item._id !== (itemId + '');\r\n    });\r\n    LocalCart.saveItems();\r\n\r\n};\r\n\r\n// Delete all items\r\nLocalCart.empty = LocalCart.emptyForMe = () => {\r\n\r\n    LocalCart.items = [];\r\n    LocalCart.saveItems();\r\n\r\n};\r\n\r\n// Load all items from the storage when initialized\r\nLocalCart.loadItems();\r\n\r\nif (typeof module === 'object') {\r\n    module.exports = LocalCart;\r\n}\r\n\r\nif (typeof window === 'object') {\r\n    if (typeof window.Clayful === 'object') {\r\n        window.Clayful.LocalCart = LocalCart;\r\n    } else {\r\n        window.Clayful = { LocalCart };\r\n    }\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}